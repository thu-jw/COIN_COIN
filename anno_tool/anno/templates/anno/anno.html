{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<title>COIN COIN annotation tool</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!--jquery and popper-->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>

<!--bootstrap css-->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<!--bootstrap js-->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<link rel="stylesheet" href="{% static 'css/anno.css' %} ">

<script>
var init = function () {
    //get scroll position in session storage

    var list_group = $("#action_name_list");
	var height = 0;
	for (let i = 0; i < {{start_step}}; i++) {
		let item = $("#action" + (i+1).toString());
		height += item.outerHeight() - 1;
	}
	list_group.scrollTop(height - 200);
};
window.onload = init;

$(window).keydown(function(e) {
  switch (e.keyCode) {
    case 67: // C
		  $("#cut").click();
		  break;
	case 65: // A
		  $("#na").click();
		  break;
	case 86: // V
		  $("#nv").click();
		  break;
	case 83: // S
		  $("#pa").click();
		  break;
	case 66: // B
		  $("#pv").click();
		  break
	default:
		  break;
	return false;
  }
});
</script>


</head>

<body>

<div class="container-fluid bg-1 text-center">
	
	<h2 class="m-4">COIN COIN Annotation </h2>
	<div class="progress m-3">
		<div class="progress-bar" role="progressbar" style="width: {{ratio_finished}}%;" aria-valuemin="0" aria-valuemax="100">{{num_finished}} / {{num_videos}}</div>
	</div>
	<div class="row" id="toprow">
		<div class="col-sm-4">
			<h4>video name<br/>
			<small>{{ video.video_name }}</small>
			</h4>
		</div>
		<div class="col-sm-4">
			<h4>video class<br/>
			<small>{{ video.video_class }}</small>
			</h4>
		</div>
		<div class="col-sm-4">
			<h4>total steps<br/>
			<small>{{ video.steps }}</small>
			</h4>
		</div>
	</div>

	<hr/>

	<div class="row">
		<div class="col-sm-3" id="action_names">
			<h4>Action names</h4>
			<ol class="list-group" id="action_name_list">
			{% for name in action_names %}
				{% if start_step|add:1 == forloop.counter %}
					<a id="action{{forloop.counter}}" class="list-group-item active" href="{% url 'anno:anno' video.id forloop.counter|add:"-1" %}">{{ forloop.counter|add:"-1" }}. {{ name }}</a>
				{% else %}
				<a id="action{{forloop.counter}}" class="list-group-item" href="{% url 'anno:anno' video.id forloop.counter|add:"-1" %}">{{ forloop.counter|add:"-1" }}. {{ name }}</a>
				{% endif %}
			{% endfor %}
			</ol>
		</div>
		<div class="col-sm-9">
			<div class="row">
				<div class="col-sm-6">
					<div style="margin:10px">{{clip_info}}</div>
				</div>
				<div class="col-sm-6">
					<form action="{% url 'anno:edit' video.id %}" method="post">
					{% csrf_token %}
					<button class="btn btn-success btn-edit" type="submit" name="edit", value="cut" id="cut">
						Cut
					</button>
					<div class="btn-group">
						<button type="button" class="btn {{cut_points|yesno:"btn-danger,btn-secondary"}} dropdown-toggle btn-edit disable" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Delete
						</button>
						{% if cut_points %}
						<div class="dropdown-menu">
							{% for point in cut_points %}
								<button class="dropdown-item" href="#" name="edit" value="{{forloop.counter|add:"-1"}}">{{point}}</button>
							{% endfor %}
							<div class="dropdown-divider"></div>
							<button class="dropdown-item" href="#" name="edit" value="-1">All</button>
						</div>
						{% endif %}
					</div>
					</form>
				</div>
			</div>
			<hr/>
			<form action="{% url 'anno:navigate' video.id %}" method="post">
			{% csrf_token %}
			<button class="btn btn-info btn-nav" type="submit" name="submit" value="pv" id="pv">
				Previous video
			</button>
			{% if start_step >= 0 %}
			<button class="btn btn-primary btn-nav" type="submit" name="submit" value="pa" id="pa">
				Previous action
			</button>
			{% endif %}

			{% if start_step|add:1 < video.steps %}
			<button class="btn btn-primary btn-nav" type="submit" name="submit" value="na" id="na">
				Next action
			</button>

			{% endif %}
			<button class="btn btn-info btn-nav" type="submit" name="submit" value="nv" id="nv">
				Next video
			</button>
			</form>

			{% if start_step in cut_points %}
			<div class="row border-between" id="images">
			{% else %}
			<div class="row" id="images">
			{% endif %}
				{% if second_img %}
				<div class="col-sm-6" align="center">
				{% else %}
				<div class="col-sm-12" align="center">
				{% endif %}
					{% with 'images/data/'|add:first_img as first_static%}
						<img src="{% static first_static %}" class="img-fluid">
					{% endwith %}
					<h5 class="img-caption">{{ start_step}}: {{ first_name }}</h5>
				</div>
				{% if second_img %}
				<div class="col-sm-6" align="center">
					{% with 'images/data/'|add:second_img as second_static%}
						<img src="{% static second_static %}" class="img-fluid">
					{% endwith %}
					<h5 class="img-caption">{{ start_step|add:"1"}}: {{ second_name }}</h5>
				</div>
				{% endif %}
			</div>

		</div>
	</div>
</div>
</body>
</html>
